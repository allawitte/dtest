!function(){"use strict";function e(e,t,o,n){e.header=!1,n(function(){e.currentUser=t.get("userId")||{},console.log(o.current.url),console.log(e.currentUser);var n=$.inArray(o.current.url,["/login","/register"])===-1,s="string"==typeof e.currentUser;n&&!s&&o.go("/login")})}angular.module("app",["ngAnimate","ui.router","ngCookies","transl","ngIntlTelInput","api.config","jmApp","ui.bootstrap","ngTouch","ui.select","imageupload","ngTable","angularUtils.directives.dirPagination","sbDateSelect","ngOnlyNumberApp"]).run(e),e.$inject=["$rootScope","$cookieStore","$state","$timeout"]}(),angular.module("api.config",[]).constant("API_ENDPOINT","http://api.hello-detox.com:/api"),function(){"use strict";function e(e){e.useStaticFilesLoader({prefix:"app/l10n/",suffix:".json"}),e.preferredLanguage("ru"),e.useSanitizeValueStrategy("escape")}angular.module("transl",["pascalprecht.translate"]).config(e),e.$inject=["$translateProvider"]}(),function(){"use strict";function e(e,t,o,n){o.defaults.withCredentials=!0;var s="app/";t.otherwise("/admin"),e.state("/home",{url:"","abstract":!0,controller:"HomeController",templateUrl:s+"pages/home/home.view.html",controllerAs:"vm",id:"home"}).state("/home.admin",{url:"/admin",templateUrl:s+"pages/admin/admin.html",controller:"DashboardController",controllerAs:"vm"}).state("/actions",{url:"",controller:"HomeController",templateUrl:s+"pages/home/home.view.html",controllerAs:"vm",id:"actions"}).state("/actions.add",{url:"/actions/add",templateUrl:s+"pages/actions/add-action.html",controller:"AddActionController",controllerAs:"vm"}).state("/actions.view",{url:"/actions/view:actionID",templateUrl:s+"pages/actions/view-action.html",controller:"ViewActionController",controllerAs:"vm"}).state("/actions.list",{url:"/actions/list",templateUrl:s+"pages/actions/list-action.html",controller:"ListActionController",controllerAs:"vm"}).state("/actions.edit",{url:"/actions/edit/:actionID",templateUrl:s+"pages/actions/edit-action.html",controller:"EditActionController",controllerAs:"vm"}).state("/receipts",{url:"","abstract":!0,controller:"HomeController",templateUrl:s+"pages/home/home.view.html",controllerAs:"vm",id:"actions"}).state("/receipts.add",{url:"/receipts/add",templateUrl:s+"pages/receipts/add-receipt.html",controller:"ReceiptsAddController",controllerAs:"vm"}).state("/receipts.list",{url:"/receipts/list",templateUrl:s+"pages/receipts/list-receipts.html",controller:"ReceiptsListController",controllerAs:"vm"}).state("/receipts.view",{url:"/receipts/view/:receiptID",templateUrl:s+"pages/receipts/view-receipt.html",controller:"ReceiptsViewController",controllerAs:"vm"}).state("/receipts.edit",{url:"/receipts/edit/:receiptID",templateUrl:s+"pages/receipts/edit-receipt.html",controller:"ReceiptsEditController",controllerAs:"vm"}).state("/programs",{url:"","abstract":!0,controller:"HomeController",templateUrl:s+"pages/home/home.view.html",controllerAs:"vm",id:"actions"}).state("/programs.add",{url:"/programs/add/:userId",params:{userId:null},templateUrl:s+"pages/programs/add.program.html",controller:"ProgramController",controllerAs:"vm",id:"program"}).state("/members",{url:"","abstract":!0,controller:"HomeController",templateUrl:s+"pages/home/home.view.html",controllerAs:"vm",id:"actions"}).state("/members.list",{url:"/members/list",templateUrl:s+"pages/users/list.members.html",controller:"MembersListController",controllerAs:"vm",id:"members"}).state("/members.view",{url:"/members/view/:userId",params:{userId:null},templateUrl:s+"pages/users/view.member.html",controller:"viewMembersController",controllerAs:"vm",id:"member"}).state("/login",{url:"/login",controller:"LoginController",templateUrl:s+"pages/login/login.view.html",controllerAs:"vm",id:"login"}).state("/register",{url:"/register",controller:"RegisterController",templateUrl:s+"pages/register/register.view.html",controllerAs:"vm",id:"login"}).state("/client",{url:"","abstract":!0,controller:"ClientController",templateUrl:s+"pages/client/client.view.html",controllerAs:"vm",id:"client"}).state("/survey",{url:"/survey",controller:"SurveyController",templateUrl:s+"pages/survey/survey.view.html",controllerAs:"vm",id:"survey"}).state("/client.prep",{url:"/client/prep",controller:"ClientPrepController",templateUrl:s+"pages/client/prep/client.prep.view.html",controllerAs:"vm",id:"office"}).state("/client.office",{url:"/client/office",controller:"ClientOfficeController",templateUrl:s+"pages/client/office/client.office.view.html",controllerAs:"vm",id:"office"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider"]}(),function(){"use strict";function e(e,t){e.$on("$stateChangeSuccess",function(t,o,n,s,r){e.page=o}),e.$on("$stateChangeError",function(e,o,n,s,r,i){angular.isString(i)||(i=JSON.stringify(i)),t.error("$stateChangeError: "+i)})}angular.module("app").controller("MainController",e),e.$inject=["$rootScope","$log"]}(),function(){"use strict";function e(e,t,o){function n(n,s){e.put(o+"/login",n).then(function(e){console.log(e.data.data),t.put("userId",e.data.data.userId);var o=e.data.data;o.success=!0,s(o)},function(e,t){console.log(e),e={success:!1,message:"LOGIN.LOGINERR"},s(e)})}var s={};return s.Login=n,s}angular.module("app").factory("AuthenticationService",e),e.$inject=["$http","$cookieStore","API_ENDPOINT"]}(),function(){"use strict";function e(e,t,o){function n(o,n){e["delete"](t+"/cards/"+o).success(function(e,t,o,s){n(e)}).error(function(e,t,o,n){c(t)})}function s(o,n,s){e.put(t+"/cards/"+o,JSON.stringify(n)).success(function(e,t,o,n){s(e)}).error(function(e,t,o,n){c(t)})}function r(o,n){e.get(t+"/cards"+o).success(function(e,t,o,s){n(e)}).error(function(e,t,o,n){c(t)})}function i(o,n){e.post(t+"/cards",JSON.stringify(o)).success(function(e,t,o,s){n(e)}).error(function(e,t,o,n){c(t)})}function a(o,n){e.get(t+"/cards/"+o).success(function(e,t,o,s){n(e)}).error(function(e,t,o,n){c(t)})}function c(e){console.log(e),403==e&&o.go("/login")}var l={};return l.actionUpload=i,l.getActionById=a,l.getAllActions=r,l.updateAction=s,l.deleteAction=n,l}angular.module("app").factory("CardsService",e),e.$inject=["$http","API_ENDPOINT","$state"]}(),function(){"use strict";function e(e){function t(){function t(){var t=e.flash;t&&(t.keepAfterLocationChange?t.keepAfterLocationChange=!1:delete e.flash)}e.$on("$locationChangeStart",function(){t()})}function o(t,o){e.flash={message:t,type:"success",keepAfterLocationChange:o}}function n(t,o){e.flash={message:t,type:"error",keepAfterLocationChange:o}}var s={};return s.Success=o,s.Error=n,t(),s}angular.module("app").factory("FlashService",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e,t){function o(o,s){e.post(t+"/opinions/firstOpinion",JSON.stringify(o)).success(function(e,t,o,n){s(e)}).error(function(e,t,o,s){n(t)})}function n(e){403==e&&$state.go("/login")}var s={};return s.createUpdateFirstOpinion=o,s}angular.module("app").factory("OpinionService",e),e.$inject=["$http","API_ENDPOINT"]}(),function(){"use strict";function e(e,t,o){function n(o,n){e.post(t+"/plandays",JSON.stringify(o)).success(function(e,t,o,s){n(e)}).error(function(e,t,o,n){s(t)})}function s(e){console.log(e),403==e&&o.go("/login")}var r={};return r.uploadProgram=n,r}angular.module("app").factory("ProgramsService",e),e.$inject=["$http","API_ENDPOINT","$state"]}(),function(){"use strict";function e(e,t,o){function n(o,n){e["delete"](t+"/recipes/"+o).success(function(e,t,o,s){n(e)}).error(function(e,t,o,n){d(t)})}function s(o,n,s){e.put(t+"/recipes/"+o,JSON.stringify(n)).success(function(e,t,o,n){s(e)}).error(function(e,t,o,n){d(t)})}function r(o,n){e.get(t+"/recipes/inventoryAutocomplete?word="+o).success(function(e,t,o,s){n(e)}).error(function(e,t,o,n){d(t)})}function i(o){if(void 0!==o)return e.get(t+"/recipes/ingredientAutocomplete?word="+o).then(function(e,t,o,n){return console.log(e.data.data),e.data.data})}function a(o,n){e.get(t+"/recipes/"+o).success(function(e,t,o,s){n(e)}).error(function(e,t,o,n){d(t)})}function c(e){return g[e]}function l(o){e.get(t+"/recipes").success(function(e,t,n,s){g=e.data.data,o(e)}).error(function(e,t,o,n){d(t)})}function p(o,n){e.post(t+"/recipes",JSON.stringify(o)).success(function(e,t,o,s){n(e)}).error(function(e,t,o,n){d(t)})}function u(o,n){e({method:"POST",url:t+"/utils/uploadImage",headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;return t.append("image",o.file),t}}).success(function(e,t,o,s){n(e)}).error(function(e,t,o,n){d(t)})}function d(e){403==e&&o.go("/login")}var m={},g={};return m.imgUpload=u,m.receiptUpload=p,m.receiptDelete=n,m.getAllReceipts=l,m.getReceiptFromList=c,m.getReceiptById=a,m.receiptUpdate=s,m.getIngrAutoComplete=i,m.getIventoryAutoComplete=r,m}angular.module("app").factory("ReceiptService",e),e.$inject=["$http","API_ENDPOINT","$state"]}(),function(){"use strict";function e(e,t){function o(o){return e.get(t+"/users"+o).then(a,c("Error getting all users"))}function n(){return e.get(t+"/users/me").then(a,c)}function s(o){return e.get(t+"/users/"+o).then(a,c)}function r(o){return e.post(t+"/register/",JSON.stringify(o)).then(a,c)}function i(){return e["delete"](t+"/logout/"+id).then(a,c("Error deleting user"))}function a(e){return console.log("res",e),e.success=!0,e}function c(e){console.log("res",e);var t;switch(e.status){case 452:t="USERS.EXISTUSER";break;case 406:t="USERS.NOTACCEPTABLE";break;default:t="USERS.REGISTERERR"}return{success:!1,message:t}}var l={};return l.GetAll=o,l.GetMe=n,l.GetById=s,l.Create=r,l.Logout=i,l}angular.module("app").factory("UserService",e),e.$inject=["$http","API_ENDPOINT"]}(),function(){"use strict";function e(e,t,o){function n(o,n){e({method:"POST",url:t+"/utils/uploadImage",headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;return t.append("image",o.file),t}}).success(function(e,t,o,s){n(e)}).error(function(e,t,o,n){s(t)})}function s(e){403==e&&o.go("/login")}var r={};return r.imgUpload=n,r}angular.module("app").factory("UtilsService",e),e.$inject=["$http","API_ENDPOINT","$state"]}(),function(){"use strict";function e(e){}angular.module("app").controller("DashboardController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t,o,n,s){function r(){g.videos.push({})}function i(e){g.videos.splice(e,1)}function a(e,t){"type"==t&&(console.log(t),g.selectedType=[!1,!1],g.selectedType[e]=!0,g.noType=!1),"media"==t&&(g.selectedMedia=[!1,!1],g.selectedMedia[e]=!0),"video"==t&&(g.selectedSource=[!1,!1],g.selectedSource[e]=!0)}function c(e){return s.trustAsResourceUrl(e)}function l(e){g.photosOk[e]=!1}function p(){g.photos.push({})}function u(t,o){e.imgUpload(t,function(e){e.data&&(void 0!=o?(g.Actions.photos[o]=e.data,g.photosOk[o]=!0):(g.Actions.titlePhoto=e.data,g.imgLoaded=!0))})}function d(e){void 0!=e?g.photos.splice(e,1):(g.Actions.titlePhoto="",g.imgLoaded=!1)}function m(){for(var e=0;e<g.videos.length;e++)if("value"in g.videos[e]){var n=g.videos[e].value,s=n.match(/https([\s\S]*?)\"/);g.Actions.videos.push(s[0].replace('"',""))}g.Actions.cardType?g.noType=!1:g.noType=!0,g.Actions.textShort?g.noName=!1:g.noName=!0,console.log(),g.noName||g.notype||t.actionUpload(g.Actions,function(e){o.go("/actions.list")})}var g=this;g.addImg=p,g.saveImg=u,g.send=m,g.removeImg=d,g.changeImg=l,g.trustSrc=c,g.changeBtn=a,g.addVideo=r,g.deleteVideo=i,g.Actions={photos:[],videos:[]},g.videos=[],g.photos=[],g.photosOk=[],g.chooseMedia=[{title:"ACTIONS.CHOOSEPICTURES",value:"picture"},{title:"ACTIONS.CHOOSEVIDEOS",value:"video"}],g.videosource=[{title:"ACTIONS.YOUTUBESOURCE",value:"youtube"},{title:"ACTIONS.LOCALSOURCE",value:"local"}],g.cardType=[{value:"ACTION",title:"ACTIONS.ACTION"},{value:"RECOMMENDATION",title:"ACTIONS.RECOMMENDATION"}],g.selectedMedia=[!1,!1],g.selectedSource=[!1,!1],g.selectedType=[!1,!1],g.mediaType=!1,g.sourceVideo=!1,g.noName=!1,g.noType=!1}angular.module("app").controller("AddActionController",e),e.$inject=["UtilsService","CardsService","$state","$scope","$sce"]}(),function(){"use strict";function e(e,t,o,n,s){function r(e,t){"type"==t&&(console.log(t),A.selectedType=[!1,!1],A.selectedType[e]=!0)}function i(e){A.Actions.videos.splice(e,1)}function a(){A.videos.push({})}function c(e){A.videos.splice(e,1)}function l(){t.deleteAction(S,function(e){console.log(e),o.go("/actions.list")})}function p(e){return s.trustAsResourceUrl(e)}function u(){A.photos.push({});var e=A.photos.length;A.savedPhotos[e-1]=!1,A.fileUplView[e-1]=!0}function d(e){A.Actions.photos.splice(e,1)}function m(e){void 0!=e?(A.savedPhotos.splice(e,1),A.photos.splice(e,1)):(A.Actions.titlePhoto="",A.imgLoaded=!1)}function g(t,o){e.imgUpload(t,function(e){void 0!=o?(A.savedPhotos[o]=e.data,A.fileUplView[o]=!1):(A.Actions.titlePhoto=e.data,A.imgLoaded=!0)})}function v(){A.Actions.titlePhoto="",A.isTitlePhoto=!1}function f(){for(var e=0;e<A.savedPhotos.length;e++)A.Actions.photos.push(A.savedPhotos[e]);for(var e=0;e<A.videos.length;e++)if("value"in A.videos[e]){var n=A.videos[e].value,s=n.match(/https([\s\S]*?)\"/);A.Actions.videos.push(s[0].replace('"',""))}A.Actions.name?t.updateAction(S,A.Actions,function(e){o.go("/actions.list")}):A.noName=!0}function h(){o.go("/actions.list")}var A=this,S=o.params.actionID;A.Actions={},A.photos=[],A.videos=[],A.savedPhotos=[],A.fileUplView=[],A.selectedType=[],A.isTitlePhoto=!1,A.cardType=[{value:"ACTION",title:"ACTIONS.ACTION"},{value:"RECOMMENDATION",title:"ACTIONS.RECOMMENDATION"}],A.removetitlePhoto=v,A.saveImg=g,A.removeImg=m,A.removeRowPhoto=d,A.addImg=u,A.send=f,A.cancel=h,A.deleteAction=l,A.trustSrc=p,A.addVideo=a,A.deleteVideo=c,A.deleteExistVideo=i,A.changeBtn=r,A.noName=!1,t.getActionById(S,function(e){A.Actions=e.data,"titlePhoto"in A.Actions&&""!=A.Actions.titlePhoto&&(A.isTitlePhoto=!0),"ACTION"==A.Actions.cardType&&(A.selectedType=[!0,!1]),"RECOMMENDATION"==A.Actions.cardType?A.selectedType=[!1,!0]:A.selectedType=[!1,!1]})}angular.module("app").controller("EditActionController",e),e.$inject=["UtilsService","CardsService","$state","$scope","$sce"]}(),function(){"use strict";function e(e,t,o,n){function s(o){for(var n=0;n<r.ActionsList.length;n++)r.ActionsList[n].id==o&&r.ActionsList.splice(n,1);t.deleteAction(o,function(e){}),r.tableParams=new e({},{dataset:r.ActionsList})}var r=this;r.ActionsList=[];var i="?size=100&from=0";r.deleteAction=s,t.getAllActions(i,function(t){var o=0;for(var n in t.data.data)r.ActionsList.push(t.data.data[n]),r.ActionsList[o].id=n,o++;r.tableParams=new e({},{dataset:r.ActionsList})})}angular.module("app").controller("ListActionController",e),e.$inject=["NgTableParams","CardsService","$state","$scope"]}(),function(){"use strict";function e(e,t,o,n){function s(){e.deleteAction(id,function(e){console.log(e),t.go("/actions.list")})}function r(e){return n.trustAsResourceUrl(e)}var i=this;i.Action={},i.deleteAction=s,i.trustSrc=r,i.edit=t.params.actionID,e.getActionById(t.params.actionID,function(e){i.Action=e.data,console.log("response is: ",e)})}angular.module("app").controller("ViewActionController",e),e.$inject=["CardsService","$state","$scope","$sce"]}(),function(){"use strict";function e(e){}angular.module("app").controller("ClientController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t){function o(){t.remove("userId"),e.go("/login")}var n=this;n.logout=o}angular.module("app").controller("HomeController",e),e.$inject=["$state","$cookieStore"]}(),function(){"use strict";function e(e,t,o){function n(){r.dataLoading=!0,t.Login(r.user,function(t){console.log(t),t.success?"ADMIN"==t.user.role?e.go("/home.admin",{eventId:"123"}):e.go("/client.office"):(o.Error(t.message),r.dataLoading=!1)})}function s(){e.go("/survey")}var r=this;r.login=n,r.register=s,r.user={}}angular.module("app").controller("LoginController",e),e.$inject=["$state","AuthenticationService","FlashService"]}(),function(){"use strict";function e(e,t,o,n,s,r,i,a){function c(e){E.program.days[e].push({time:p(e),actions:[{}]}),y=E.program.days[e].length-1,C=0}function l(){var e=E.program.days.length;N=p(e),E.program.days.push([{time:N,actions:[{}]}]),y=0,T=E.program.days.length-1,C=0}function p(e){var t=new Date(2e3,1,1+e);return t.setHours(7),t.setMinutes(0),console.log(E.program.days),t}function u(e){a(function(){E.program.days[e].sort(v)},2e3)}function d(e){return i.trustAsHtml(e)}function m(e,t,o,n){e.selected=e.name,E.program.days[o][t].actions[n]=e}function g(e,t){E.program.days[t][e].actions.push({}),E.modalClose=!1,y=e,T=t,C=E.program.days[t][e].actions.length-1}function v(e,t){return e.time-t.time}function f(){E.modalClose=!0}function h(e){E.program.days[T][y].actions[C]=E.cardsIndex[e]}function A(e,t,o){E.modalClose=!1}function S(){E.PlanDayCreate.memberId||(E.PlanDayCreate.memberId=E.user.memberId),E.PlanDayCreate.planDay=E.program.planDay;for(var e=0,t=0;t<E.program.days.length;t++)for(var o=0;o<E.program.days[t].length;o++){E.PlanDayCreate.planBuckets.push({bucketTimestamp:Date.parse(E.program.days[t][o].time)});for(var s=0;s<E.program.days[t][o].actions.length;s++)"RECEIPT"==E.program.days[t][o].actions[s].type?("recipes"in E.PlanDayCreate.planBuckets[e]||(E.PlanDayCreate.planBuckets[e].recipes=[]),E.PlanDayCreate.planBuckets[e].recipes.push(E.receipts[E.program.days[t][o].actions[s].id])):("cards"in E.PlanDayCreate.planBuckets[e]||(E.PlanDayCreate.planBuckets[e].cards=[]),E.PlanDayCreate.planBuckets[e].cards.push(E.actions[E.program.days[t][o].actions[s].id]));e++}n.uploadProgram(E.PlanDayCreate,function(e){console.log(e)})}function R(){}var E=this;E.addTime=c,E.addDay=l,E.trustSrc=d,E.changed=u,E.onSelectCallback=m,E.addCard=g,E.closeModal=f,E.pendCard=h,E.changeCard=A,E.send=S,E.cancel=R,E.program={},E.program.days=[[]],E.cards=[],E.cardsIndex=[],E.receipts=[],E.actions=[],E.PlanDayCreate={},E.PlanDayCreate.planBuckets=[],E.PlanDayCreate.memberId=s.params.userId,E.showUsersList=s.params.userId,E.modalClose=!0,E.users=[],E.user={};var y=0,T=0,C=0,I="?size=100&from=0";r.hstep=1,r.mstep=15,r.update=p,r.ismeridian=!1;var N=p(0);E.program.days[0]=[{time:N,actions:[{}]}],E.program.memberId||e.GetAll(I).then(function(e){var t=0;for(var o in e.data.data.data)E.users.push(e.data.data.data[o]),E.users[t].id=o,t++}),t.getAllReceipts(function(e){E.receipts=e.data.data;for(var t in e.data.data)E.cards.push({id:t,name:e.data.data[t].name.match(/<h2>(.*?)<\/h2>/i)[1],type:"RECEIPT"}),E.cardsIndex[t]={id:t,name:e.data.data[t].name.match(/<h2>(.*?)<\/h2>/i)[1],type:"RECEIPT"}}),o.getAllActions(I,function(e){E.actions=e.data.data;for(var t in e.data.data)E.cards.push({id:t,name:e.data.data[t].textShort,type:e.data.data[t].cardType}),E.cardsIndex[t]={id:t,name:e.data.data[t].textShort,type:e.data.data[t].cardType}})}angular.module("app").controller("ProgramController",e),e.$inject=["UserService","ReceiptService","CardsService","ProgramsService","$state","$scope","$sce","$timeout"]}(),function(){"use strict";function e(){return function(e,t){var o=[];if(angular.isArray(e)){var n=Object.keys(t);e.forEach(function(e){for(var s=!1,r=0;r<n.length;r++){var i=n[r],a=t[i].toLowerCase();if(e[i].toString().toLowerCase().indexOf(a)!==-1){s=!0;break}}s&&o.push(e)})}else o=e;return o}}angular.module("app").filter("propsFilter",e)}(),function(){"use strict";function e(e,t){function o(t){return e.getIngrAutoComplete(t)}function n(){g.Receipt.ingredients.length;g.Receipt.ingredients.push({})}function s(){g.Receipt.inventory.length;g.Receipt.inventory.push("")}function r(e){g.Receipt.ingredients.splice(e,1)}function i(e){g.Receipt.inventory.splice(e,1)}function a(){var o=[],n="",s={},r=0,i="",a="";s.dailyCalories=[],s.ingredients=[];var c=0;for(c=0;c<g.steps.length;c++){for(var l=0;l<g.steps[c].photos.length;l++)g.steps[c].photos[l].img&&o.push(g.steps[c].photos[l].img);g.steps[c].photos=o,o=[]}for(n="<h2>"+g.Receipt.name+"</h2><span>"+g.subname+"</span>",s.name=n||"",s.photo=g.Receipt.photo||"",s.shortDescription=g.Receipt.shortDescription||"",s.timeCookMinutes=g.Receipt.timeCookMinutes||0,s.servesCount=g.Receipt.servesCount||0,s.difficult=g.Receipt.difficult.val,s.inventory=g.Receipt.inventory||"",s.steps=g.steps,c=0;c<g.Receipt.dailyCalories.length;c++)r=g.Receipt.dailyCalories[c].value,a=g.Receipt.dailyCalories[c].type,s.dailyCalories.push({value:r,type:a});for(c=0;c<g.Receipt.ingredients.length;c++){i=g.Receipt.ingredients[c].name,r=g.Receipt.ingredients[c].value;var p=g.Receipt.ingredients[c].unit.val;s.ingredients.push({name:i,value:r,unit:p})}g.Receipt.name?e.receiptUpload(s,function(e){t.go("/receipts.list")}):g.noName=!0}function c(){var e=g.steps.length+1;g.steps.push({stepNumber:e,photos:[{id:0}]})}function l(e){g.steps.splice(e,1)}function p(e){var t=g.steps[e].photos.length;g.steps[e].photos.push({id:t})}function u(e,t){void 0!==e?g.steps[e].photos.splice(t,1):g.Receipt.photo=""}function d(t,o,n){e.imgUpload(t,function(e){e.data&&(void 0!=o?g.steps[o].photos[n].img=e.data:(g.Receipt.photo=e.data,g.imgLoaded=!0))})}function m(){t.go("/receipts.list")}var g=this;g.edit=!0,g.view=!1,g.addIngredient=n,g.removeIngredient=r,g.send=a,g.cancel=m,g.addImg=p,g.saveImg=d,g.removeImg=u,g.addStep=c,g.removeStep=l,g.autocompleteIngr=o,g.addTool=s,g.removeTool=i,g.ingredients=[""],g.inventory=[],g.subname="",g.imgLoaded=!1,g.noName=!1,e.getIventoryAutoComplete("",function(e){g.inventory=e.data}),g.Receipt={name:"",photo:"",shortDescription:"",timeCookMinutes:"",servesCoun:"",difficult:{val:"EASY",translateval:"LEVELS.EASY"},inventory:[""],dailyCalories:[{type:"CALORIE",value:"",dayPercentageCount:0,translateval:"HEADERS.ENERGY"},{type:"FAT",value:"",dayPercentageCount:0,translateval:"HEADERS.FAT"},{type:"CARBOHYDRATE",value:"",dayPercentageCount:0,translateval:"HEADERS.CARB"},{type:"PROTEIN",value:"",dayPercentageCount:0,translateval:"HEADERS.PROTEIN"}],ingredients:[{}],steps:[{photos:[{id:0}]}]},g.difficult=[{val:"EASY",translateval:"LEVELS.EASY"},{val:"MEDIUM",translateval:"LEVELS.MEDIUM"},{val:"HARD",translateval:"LEVELS.HARD"}],g.units=[{val:"COUNT",translateval:"UNITS.UNITS"},{val:"TABLESPOON",translateval:"UNITS.TABLESP"},{val:"GRAM",translateval:"UNITS.GR"},{val:"TEASPOON",translateval:"UNITS.TEASP"},{val:"LITER",translateval:"UNITS.LITER"},{val:"KG",translateval:"UNITS.KG"},{val:"GLASS",translateval:"UNITS.GLASS"}],g.cardTypeArr=[{name:"CARD_TYPE.SELECT"},{name:"CARD_TYPE.RECEIPT"},{name:"CARD_TYPE.ACTIVITY"}],g.steps=[{stepNumber:1,photos:[{id:0}]}],g.Receipt.ingredients[0].unit=g.units[0]}angular.module("app").controller("ReceiptsAddController",e),e.$inject=["ReceiptService","$state"]}(),function(){"use strict";function e(e,t,o){function n(){e.receiptDelete(t.receiptID,function(e){o.go("/receipts.list")})}function s(e,t){void 0===e?(h.Receipt.photo="",h.isMainPhoto=!1):(console.log("vm.Receipt.steps[stepIndex].photos ",h.Receipt.steps[e].photos),h.Receipt.steps[e].photos.splice(t,1))}function r(t){return e.getIngrAutoComplete(t)}function i(){h.Receipt.ingredients.push({})}function a(){h.Receipt.inventory.push("")}function c(e){h.Receipt.ingredients.splice(e,1)}function l(e){h.Receipt.inventory.splice(e,1)}function p(e){console.log("step ind",e,h.steps[e]);var t=h.steps[e].photos.length||0;h.steps[e].photos.push({id:t})}function u(){var e=h.Receipt.steps.length+1;h.Receipt.steps.push({stepNumber:e,photos:[""]}),h.steps.push({photos:[{}]}),console.log("steps",h.steps)}function d(e){h.Receipt.steps.splice(e,1)}function m(e,t){void 0!==e?h.steps[e].photos.splice(t,1):h.Receipt.photo=""}function g(t,o,n){e.imgUpload(t,function(e){e.data&&(void 0!=o?h.steps[o].photos[n].img=e.data:(h.Receipt.photo=e.data,h.imgLoaded=!0))})}function v(){var n=[],s="",r={},i=0,a="",c="",l=0;r.dailyCalories=[],r.ingredients=[],r.steps=h.Receipt.steps,console.log("vm.Receipt.steps ",h.Receipt.steps);var p=0;for(console.log("vm.steps = ",h.steps),p=0;p<h.steps.length-1;p++){for(var u=0;u<h.steps[p].photos.length;u++)h.steps[p].photos[u].img&&n.push(h.steps[p].photos[u].img);h.steps[p].photos=n,n=[],console.log("i=",p),r.steps[p].photos=r.steps[p].photos.concat(h.steps[p].photos),console.log("vm.steps[i].photos is: ",h.steps[p].photos),console.log("backReceipt.steps[i].photos is: ",r.steps[p].photos)}for(s="<h2>"+h.Receipt.name+"</h2><span>"+h.subname+"</span>",r.name=s||"",r.photo=h.Receipt.photo||"",r.shortDescription=h.Receipt.shortDescription||"",r.timeCookMinutes=h.Receipt.timeCookMinutes||0,r.servesCount=h.Receipt.servesCount||0,r.difficult=h.Receipt.difficult.val,r.inventory=h.Receipt.inventory||"",p=0;p<h.Receipt.dailyCalories.length;p++)i=h.Receipt.dailyCalories[p].value,c=h.Receipt.dailyCalories[p].type,l=h.Receipt.dailyCalories[p].dayPercentageCount||0,r.dailyCalories.push({value:i,type:c,dayPercentageCount:l});for(p=0;p<h.Receipt.ingredients.length;p++){a=h.Receipt.ingredients[p].name,i=h.Receipt.ingredients[p].value;var d=h.Receipt.ingredients[p].unit.val;r.ingredients.push({name:a,value:i,unit:d})}console.log("backReceipt is: ",r),h.Receipt.name?e.receiptUpdate(t.receiptID,r,function(e){o.go("/receipts.list")}):h.noName=!0}function f(){o.go("/receipts.list")}var h=this;h.steps=[{photos:[]}],h.send=v,h.cancel=f,h.removePrevImg=s,h.addImg=p,h.saveImg=g,h.removeImg=m,h.addStep=u,h.removeStep=d,h.autocompleteIngr=r,h.deleteReceipt=n,h.addTool=a,h.removeTool=l,h.addIngredient=i,h.removeIngredient=c,h.Receipt={},h.noName=!1,h.id=t.receiptID,e.getIventoryAutoComplete("",function(e){h.inventory=e.data}),h.difficult=[{val:"EASY",translateval:"LEVELS.EASY"},{val:"MEDIUM",translateval:"LEVELS.MEDIUM"},{val:"HARD",translateval:"LEVELS.HARD"}],h.units=[{val:"COUNT",translateval:"UNITS.UNITS"},{val:"TABLESPOON",translateval:"UNITS.TABLESP"},{val:"GRAM",translateval:"UNITS.GR"},{val:"TEASPOON",translateval:"UNITS.TEASP"},{val:"LITER",translateval:"UNITS.LITER"},{val:"KG",translateval:"UNITS.KG"},{val:"GLASS",translateval:"UNITS.GLASS"}];var A={EASY:"LEVELS.EASY",MEDIUM:"LEVELS.MEDIUM",HARD:"LEVELS.HARD"},S={COUNT:"UNITS.UNITS",TABLESPOON:"UNITS.TABLESP",GRAM:"UNITS.GR",TEASPOON:"UNITS.TEASP",LITER:"UNITS.LITER",KG:"UNITS.KG",GLASS:"UNITS.GLASS"},R=["HEADERS.ENERGY","HEADERS.FAT","HEADERS.CARB","HEADERS.PROTEIN"];console.log(h.id),e.getReceiptById(t.receiptID,function(e){if(h.Receipt=e.data,h.Receipt.name){var t=h.Receipt.name;h.Receipt.name=t.match(/<h2>(.*?)<\/h2>/i)[1],h.subname=t.match(/<span>(.*?)<\/span>/i)[1]}var o=h.Receipt.difficult;if(h.Receipt.difficult={},h.Receipt.difficult.val=o,h.Receipt.difficult.translateval=A[o],h.isMainPhoto=!!h.Receipt.photo,h.Receipt.dailyCalories)for(var n=0;n<h.Receipt.dailyCalories.length;n++)h.Receipt.dailyCalories[n].translateval=R[n];else h.Receipt.dailyCalories=[{type:"CALORIE",value:"",dayPercentageCount:0,translateval:"HEADERS.ENERGY"},{type:"FAT",value:"",dayPercentageCount:0,translateval:"HEADERS.FAT"},{type:"CARBOHYDRATE",value:"",dayPercentageCount:0,translateval:"HEADERS.CARB"},{type:"PROTEIN",value:"",dayPercentageCount:0,translateval:"HEADERS.PROTEIN"}];if(Array.isArray(h.Receipt.ingredients))for(var n=0;n<h.Receipt.ingredients.length;n++){var s=h.Receipt.ingredients[n].unit;h.Receipt.ingredients[n].unit={},h.Receipt.ingredients[n].unit.val=s,h.Receipt.ingredients[n].unit.translateval=S[s]}if(Array.isArray(h.Receipt.steps))for(var n=0;n<h.Receipt.steps.length;n++)h.steps.push({photos:[{}]})})}angular.module("app").controller("ReceiptsEditController",e),e.$inject=["ReceiptService","$stateParams","$state"]}(),function(){"use strict";function e(e,t,o){function n(o){for(var n=0;n<s.ReceiptsList.length;n++)s.ReceiptsList[n].id==o&&s.ReceiptsList.splice(n,1);e.receiptDelete(o,function(e){}),s.tableParams=new t({},{dataset:s.ReceiptsList})}var s=this;s.titles=[],s.ReceiptsList=[],s.deleteReceipt=n,e.getAllReceipts(function(e){var o=0;for(var n in e.data.data){s.ReceiptsList.push(e.data.data[n]),s.ReceiptsList[o].id=n;var r=s.ReceiptsList[o].name;s.ReceiptsList[o].name=r.match(/<h2>(.*?)<\/h2>/i)[1],s.ReceiptsList[o].dailyCalories||(s.ReceiptsList[o].dailyCalories=[{value:0},{value:0},{value:0},{value:0}]),s.ReceiptsList[o].cal=s.ReceiptsList[o].dailyCalories[0].value,s.ReceiptsList[o].dailyCalories.length>1&&(s.ReceiptsList[o].fat=s.ReceiptsList[o].dailyCalories[1].value),s.ReceiptsList[o].dailyCalories.length>2&&(s.ReceiptsList[o].carb=s.ReceiptsList[o].dailyCalories[2].value),s.ReceiptsList[o].dailyCalories.length>3&&(s.ReceiptsList[o].prot=s.ReceiptsList[o].dailyCalories[3].value),delete s.ReceiptsList[o].dailyCalories,o++}s.tableParams=new t({},{dataset:s.ReceiptsList})})}angular.module("app").controller("ReceiptsListController",e),e.$inject=["ReceiptService","NgTableParams","$state"]}(),function(){"use strict";function e(e,t,o,n){var s=this;s.Receipt={},s.header="";var r={EASY:"LEVELS.EASY",MEDIUM:"LEVELS.MEDIUM",HARD:"LEVELS.HARD"};s.titles=["HEADERS.CAL","HEADERS.CARB","HEADERS.PROTEIN","HEADERS.FAT"],s.units={COUNT:"UNITS.UNITS",TABLESPOON:"UNITS.TABLESP",GRAM:"UNITS.GR",TEASPOON:"UNITS.TEASP",LITER:"UNITS.LITER",KG:"UNITS.KG",GLASS:"UNITS.GLASS"},s.id=n.receiptID,t.getReceiptById(s.id,function(e){s.Receipt=e.data,s.header=o.trustAsHtml(s.Receipt.name),s.difficult=r[s.Receipt.difficult]})}angular.module("app").controller("ReceiptsViewController",e),e.$inject=["$scope","ReceiptService","$sce","$stateParams"]}(),function(){"use strict";function e(e,t,o){function n(){s.dataLoading=!0,e.Create(s.user).then(function(e){console.log("response is: ",e),e.success?(o.Success("LOGIN.SUCCESS",!0),t.path("/login")):(o.Error(e.message),s.dataLoading=!1)})}var s=this;s.register=n}angular.module("app").controller("RegisterController",e),e.$inject=["UserService","$location","FlashService"]}(),function(){"use strict";function e(e,t,o,n){function s(e){for(var t=0;t<2;t++)u.gender[t].selected=!1;u.gender[e].selected=!0,u.survey.answerGroups[2].answerText[0]=u.gender[e].name}function r(e){for(var t=0;t<3;t++)u.bodytype[t].selected=!1;u.survey.answerGroups[7].answerText[0]=u.bodytype[e].name,u.bodytype[e].selected=!0}function i(e){for(var t=0;t<4;t++)u.activity[t].selected=!1;u.activity[e].selected=!0,u.survey.answerGroups[6].answerText[0]=u.activity[e].name}function a(){u.survey.opinionId="firstOpinion",u.survey.opinionName="",u.survey.timestamp=Date.parse(new Date);for(var e=0;e<3;e++)1==u.purpose[e].selected&&(u.survey.answerGroups[0].answerText[e]=u.purpose[e].name);t.createUpdateFirstOpinion(u.survey,function(e){o.go("/client.office")})}function c(){switch(u.step){case 0:if(!u.purpose[0].selected&&!u.purpose[1].selected&&!u.purpose[2].selected||!u.survey.answerGroups[1].answerText[0])return void(u.check1=!0);break;case 1:if(!u.survey.answerGroups[2].answerText[0]||!u.survey.answerGroups[3].answerText[0]||!u.survey.answerGroups[4].answerText[0])return void(u.check2=!0);break;case 2:if(!u.survey.answerGroups[6].answerText[0])return void(u.check3=!0);break;case 3:if(!u.survey.answerGroups[7].answerText[0])return void(u.check4=!0);break;case 4:var e=u.survey.answerGroups[9].answerText[0],t=e.match(/.+@.+\..+/i);if(console.log(t),!t)return u.wrongEmail=!0,void(u.check5=!0);if(u.survey.answerGroups[10].answerText[0]!=u.pass)return u.wrongPass=!0,void(u.check5=!0);if(!(u.survey.answerGroups[8].answerText[0]&&u.survey.answerGroups[9].answerText[0]&&u.survey.answerGroups[10].answerText[0]&&u.survey.answerGroups[11].answerText[0]))return void(u.check5=!0);d.fullname=u.survey.answerGroups[8].answerText[0],d.phone=u.survey.answerGroups[11].answerText[0],d.email=u.survey.answerGroups[9].answerText[0],d.password=u.survey.answerGroups[10].answerText[0],n.Create(d).then(function(e){console.log("response is: ",e.data.data.userId),u.survey.userId=e.data.data.userId,e.success||(u.check5=!0)})}l()}function l(){u.wrongPass=!1,u.check1=!1,u.check2=!1,u.check3=!1,u.check4=!1,u.check5=!1,u.step<6?u.step++:u.step,console.log(u.step);for(var e=0;e<u.stepsActions.length;e++)u.stepsActions[e]="done";u.stepsActions[u.step]="active",u.stepBar="step"+(u.step+1)}function p(){u.stepsActions[u.step]="",u.step--,u.stepsActions[u.step]="active",u.stepBar="step"+(u.step+1)}var u=this,d={};
u.send=a,u.changeGender=s,u.changeBodyType=r,u.changeActivity=i,u.stepBar="step1",u.step=0,u.stepsActions=[],u.next=c,u.back=p,u.survey={},u.check1=!1,u.check2=!1,u.check3=!1,u.wrongEmail=!1,u.check4=!1,u.check5=!1,u.wrongPass=!1,u.survey.answerGroups=[];var m=["цель","желаемый вес","пол","дата рождения","рост","вес","активность","телосложение","имя","еиайл","пароль","телефон"].map(function(e){return encodeURIComponent(e)});u.stepsNames=["SURVEY-HEADERS.STEP1","SURVEY-HEADERS.STEP2","SURVEY-HEADERS.STEP3","SURVEY-HEADERS.STEP4","SURVEY-HEADERS.STEP5","SURVEY-HEADERS.STEP6"],u.stepsActions[0]="active";for(var g=0;g<m.length;g++)u.survey.answerGroups[g]={name:m[g],answerText:[""]};u.survey.answerGroups[3].answerText[0]="1993-07-03",u.gender=[{name:"GENDER.MALE",selected:!1},{name:"GENDER.FEMALE",selected:!1}],u.activity=[{name:"SURVEY-HEADERS.INTENS4",selected:!1},{name:"SURVEY-HEADERS.INTENS1",selected:!1},{name:"SURVEY-HEADERS.INTENS2",selected:!1},{name:"SURVEY-HEADERS.INTENS3",selected:!1}],u.purpose=[{name:"PURPOSE.1",selected:!1},{name:"PURPOSE.2",selected:!1},{name:"PURPOSE.3",selected:!1}],u.bodytype=[{name:"BODYTYPE.1",selected:!1},{name:"BODYTYPE.2",selected:!1},{name:"BODYTYPE.3",selected:!1}]}angular.module("app").controller("SurveyController",e),e.$inject=["$cookieStore","OpinionService","$state","UserService"]}(),function(){"use strict";function e(e,t,o){function n(e){o.go("/members.view",{userId:e})}var s=this,r="?size=100&from=0";s.users=[],s.viewMember=n,e.GetAll(r).then(function(e){console.log(e);var o=0;for(var n in e.data.data.data)s.users.push(e.data.data.data[n]),s.users[o].id=n,o++;s.tableParams=new t({},{dataset:s.users})})}angular.module("app").controller("MembersListController",e),e.$inject=["UserService","NgTableParams","$state"]}(),function(){"use strict";function e(e,t,o){var n=this;n.user={},e.GetById(o.params.userId).then(function(e){n.user=e.data.data}),console.log(o.params.userId)}angular.module("app").controller("viewMembersController",e),e.$inject=["UserService","NgTableParams","$state"]}(),function(){"use strict";function e(e,t,o,n){t.header=!0,console.log("OfficeCtrl")}angular.module("app").controller("ClientOfficeController",e),e.$inject=["$state","$rootScope","ReceiptService","$sce"]}(),function(){"use strict";function e(e,t,o,n){t.header=!0,t.page.id="prep-page",console.log("PrepCtrl");var s=this,r=["AVgnarz8w90xysTpf8NU","AVgncQXWw90xysTpf8NW","AVgnZcJew90xysTpf8NT"];s.receips=[],s.units={COUNT:"UNITS.UNITS",TABLESPOON:"UNITS.TABLESP",GRAM:"UNITS.GR",TEASPOON:"UNITS.TEASP",LITER:"UNITS.LITER",KG:"UNITS.KG",GLASS:"UNITS.GLASS"},r.forEach(function(e){o.getReceiptById(e,function(e){var t=e.data;t.name=n.trustAsHtml(t.name),s.receips.push(t),console.log(s.receips)})})}angular.module("app").controller("ClientPrepController",e),e.$inject=["$state","$rootScope","ReceiptService","$sce"]}();